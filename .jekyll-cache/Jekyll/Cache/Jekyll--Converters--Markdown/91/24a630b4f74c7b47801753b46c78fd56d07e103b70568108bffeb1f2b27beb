I"“=<p>å‚è€ƒï¼šhttps://www.plob.org/article/11869.html</p>

<p>ç”»å›¾ï¼šhttps://cran.r-project.org/web/packages/ggfortify/vignettes/plot_pca.html</p>

<h2 id="ç›®çš„æµ‹è¯•ç­›é€‰å˜å¼‚ç³»æ•°æœ€å¤§çš„å‰3ä¸ªåŸºå› å¯¹æ‰€æœ‰æ ·æœ¬ä½œpcaåˆ†æ">ç›®çš„ï¼šæµ‹è¯•ï¼šç­›é€‰å˜å¼‚ç³»æ•°æœ€å¤§çš„å‰3ä¸ªåŸºå› ï¼Œå¯¹æ‰€æœ‰æ ·æœ¬ä½œPCAåˆ†æ</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>
library(useful)
setwd("~/data/ciona_i/rna_seq/expression/stringtie/ref_only/")
read.table("gene_ftkm_all_samples.tsv",header=TRUE,row.names = 1,sep="\t")-&gt;expression_data
expression_data[,1:6]-&gt;expression_data
as.matrix(expression_data)-&gt;expression_data
#å»é™¤è¡¨è¾¾å€¼å…¨ä¸º0çš„è¡Œï¼Œæœ‰äº›è¿˜ä¼šä½œå…¶å®ƒç­›é€‰ï¼Œå¦‚ä½è¡¨è¾¾ï¼Œç­‰
expression_data_nonzeron&lt;-expression_data[rowSums(expression_data)!=0,]
#å¯¹äºè¡¨è¾¾è°±æ•°æ®ï¼Œå› ä¸ºæ¶‰åŠåˆ°PCRçš„æŒ‡æ•°æ‰©å¢ï¼Œä¸€èˆ¬ä¼šå–logå¤„ç†
#å…¶å®ƒæ•°æ®logå¤„ç†ä¼šé™ä½æ•°æ®ä¹‹é—´çš„å·®å¼‚ï¼Œä¸ä¸€å®šé€‚ç”¨
expression_log2&lt;-log2(expression_data_nonzeron+1)

</pre></td></tr></tbody></table></code></pre></div></div>

<p>è®¡ç®—å˜å¼‚ç³»æ•°ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>cv&lt;-apply(expression_log2,1,sd)/rowMeans(expression_log2)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ ¹æ®å˜å¼‚ç³»æ•°æ’åºï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>expression_log2&lt;-expression_log2[order(cv,decreasing = T),]
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è®¡ç®—ä¸­å€¼ç»å¯¹åå·® (MAD, median absolute deviation)<strong>åº¦é‡åŸºå› è¡¨è¾¾å˜åŒ–å¹…åº¦</strong>ã€‚åœ¨åŸºå› è¡¨è¾¾ä¸­ï¼Œå°½ç®¡æŸäº›åŸºå› å¾ˆå°çš„å˜åŒ–ä¼šå¯¼è‡´é‡è¦çš„ç”Ÿç‰©å­¦æ„ä¹‰ï¼Œä½†æ˜¯å¾ˆå°çš„è§‚å¯Ÿå€¼ä¼šå¼•å…¥å¾ˆå¤§çš„èƒŒæ™¯å™ªéŸ³ï¼Œå› æ­¤ä¹Ÿæ„ä¹‰ä¸å¤§ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>mads&lt;-apply(expression_log2,1,mad)
expression_log2&lt;-expression_log2[rev(order(mads)),]
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ç­›é€‰å‰3è¡Œï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>data_var3&lt;-expression_log2[1:3,]
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è½¬ç½®ï¼Œä½¿å¾—çŸ©é˜µæ¯ä¸€è¡Œä¸ºä¸€ä¸ªæ ·å“ï¼Œæ¯ä¸€åˆ—ä¸ºå˜é‡ï¼Œå³æ¯ä¸ªåŸºå› è¡¨è¾¾é‡</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>data_var3_forPCA&lt;-t(data_var3)
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre># è·å¾—æ ·å“åˆ†ç»„ä¿¡æ¯
sample &lt;- rownames(data_var3_forPCA)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æŠŠæ ·å“åå­—æŒ‰ <_> åˆ†å‰²ï¼Œå–å‡ºå…¶ç¬¬äºŒéƒ¨åˆ†ä½œä¸ºæ ·å“çš„ç»„å</_></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>###lapply(X, FUC) å¯¹åˆ—è¡¨æˆ–å‘é‡ä¸­æ¯ä¸ªå…ƒç´ æ‰§è¡ŒFUCæ“ä½œï¼ŒFUNCä¸ºè‡ªå®šä¹‰æˆ–Rè‡ªå¸¦çš„å‡½æ•°
group &lt;- unlist(lapply(strsplit(sample, "_"), function(x) x[1]))
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>#æ ¹æ®åˆ†ç»„æ•°ç›®ç¡®å®šé¢œè‰²å˜é‡
colorA &lt;- rainbow(length(unique(group)))
# æ ¹æ®æ¯ä¸ªæ ·å“çš„åˆ†ç»„ä¿¡æ¯è·å–å¯¹åº”çš„é¢œè‰²å˜é‡
colors &lt;- colorA[as.factor(group)]
# æ ¹æ®æ ·å“åˆ†ç»„ä¿¡æ¯è·å¾—legendçš„é¢œè‰²
colorl &lt;- colorA[as.factor(unique(group))]

scatterplot3d(data_var3_forPCA[,1:3], color=colors)
legend("top", legend=levels(as.factor(group)), col=colorl, pch=16, xpd=T, horiz=F, ncol=6)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/Users/cooper/Desktop/%E6%96%87%E7%8C%AE/typora/science/image-20200402164902387.png" alt="image-20200402164902387" /></p>

<p>æˆ‘ä»¬çœ‹åˆ°å›¾ä¸­çš„æ ·å“å¹¶æ²¡æœ‰æŒ‰ç…§é¢„å…ˆè®¾å®šçš„æ ‡ç­¾å®Œå…¨åˆ†å¼€ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹æ³•ç­›é€‰å˜å¼‚æœ€å¤§çš„ä¸‰ä¸ªåŸºå› ï¼Œæœ€ç»ˆçš„åˆ†ç±»æ•ˆæœä¸ä¼šç›¸å·®å¾ˆå¤§ã€‚å› ä¸ºä¸ç®¡æ€ä¹ˆç­›é€‰ï¼Œæˆ‘ä»¬éƒ½åªç”¨åˆ°äº†3ä¸ªåŸºå› çš„è¡¨è¾¾é‡ã€‚</p>

<h2 id="pca">PCA</h2>

<p>å‡å¦‚æˆ‘ä»¬æŠŠè¿™ä¸ªæ•°æ®ç”¨PCAæ¥åˆ†ç±»ï¼Œç»“æœæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>

<h3 id="ç”¨fpkm">ç”¨FPKM</h3>

<p>å¯¹ä¹‹å‰logåŒ–çš„è¡¨è¾¾çŸ©é˜µè½¬ç½®ï¼šï¼Œè¡Œä¸ºåŸºå› ï¼Œåˆ—ä¸ºæ ·æœ¬</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>expression_log2_t&lt;-t(expression_log2)
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>#groupåœ¨å‰é¢å®šä¹‰è¿‡äº†ï¼ŒAdd group column for plotting

label&lt;-as.data.frame(expression_log2_t)
label$group&lt;-group
</pre></td></tr></tbody></table></code></pre></div></div>

<p>prcomp() å‡½æ•°é»˜è®¤ä¸­å¿ƒåŒ–ä¸ºå‡å»å¹³å‡å€¼ï¼Œæ ‡å‡†åŒ–ç”¨æ ‡å‡†å·®</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre># By default, prcomp will centralized the data using mean.
# Normalize data for PCA by dividing each data by column standard deviation.
# Often, we would normalize data.
# Only when we care about the real number changes other than the trends,
# `scale` can be set to TRUE. 
# We will show the differences of scaling and un-scaling effects.
pca&lt;-prcomp(expression_log2_t,scale=T)
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre># sdev: standard deviation of the principle components.
# Square to get variance
percentVar &lt;- pca$sdev^2 / sum( pca$sdev^2)
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>library(ggfortify)
autoplot(pca, data=label, colour="group") + xlab(paste0("PC1 (", round(percentVar[1]*100), "% variance)")) + ylab(paste0("PC2 (", round(percentVar[2]*100), "% variance)")) + theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.position="right")
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/Users/cooper/Desktop/%E6%96%87%E7%8C%AE/typora/science/image-20200402175023665.png" alt="image-20200402175023665" /></p>

<p>é‡‡ç”¨3ä¸ªä¸»æˆåˆ†è·å¾—çš„åˆ†ç±»æ•ˆæœä¼˜äº2ä¸ªä¸»æˆåˆ†ï¼Œå› ä¸ºè¿™æ ·ä¿ç•™çš„åŸå§‹ä¿¡æ¯æ›´å¤šã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre># è·å¾—PCH symbolåˆ—è¡¨
pch_l &lt;- as.numeric(as.factor(unique(group)))
# äº§ç”Ÿæ¯ä¸ªæ ·å“çš„pch symbol
pch &lt;- pch_l[as.factor(group)]

pc &lt;- as.data.frame(pca$x)
scatterplot3d(x=pc$PC1, y=pc$PC2, z=pc$PC3, pch=pch, color=colors, xlab=paste0("PC1 (", round(percentVar[1]*100), "% variance)"), ylab=paste0("PC2 (", round(percentVar[2]*100), "% variance)"), zlab=paste0("PC3 (", round(percentVar[3]*100), "% variance)"))

legend(-3,8, legend=levels(as.factor(group)), col=colorl, pch=pch_l, xpd=T, horiz=F, ncol=6)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/Users/cooper/Desktop/%E6%96%87%E7%8C%AE/typora/science/image-20200402181842338.png" alt="image-20200402181842338" /></p>

<p>è¿˜æ˜¯æ²¡æœ‰èšåœ¨ä¸€èµ·ï¼Ÿ</p>

<p>å½“åªä¸­å¿ƒåŒ–æ—¶ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>pca&lt;-prcomp(expression_log2_t)
percentVar &lt;- pca$sdev^2 / sum( pca$sdev^2)
autoplot(pca, data=label, colour="group") + xlab(paste0("PC1 (", round(percentVar[1]*100), "% variance)")) + ylab(paste0("PC2 (", round(percentVar[2]*100), "% variance)")) + theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.position="right")
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/Users/cooper/Desktop/%E6%96%87%E7%8C%AE/typora/science/image-20200402185224785.png" alt="image-20200402185224785" /></p>

<p>autoplotä¸€è¡Œä»£ç è‡ªåŠ¨ç”»ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>autoplot(prcomp(expression_log2_t),data=label,colour='group',shape=FALSE,label.size=3)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/Users/cooper/Desktop/%E6%96%87%E7%8C%AE/typora/science/image-20200402191056845.png" alt="image-20200402191056845" /></p>

<p>ç”»ä¸‰ç»´å›¾ä»£ç ä¸å‰é¢ç›¸åŒï¼š</p>

<p><img src="/Users/cooper/Desktop/%E6%96%87%E7%8C%AE/typora/science/image-20200402185402966.png" alt="image-20200402185402966" /></p>

<h4 id="æ²¡æœ‰èšåœ¨ä¸€èµ·çœ‹httpswwwbiostarsorgp332836">æ²¡æœ‰èšåœ¨ä¸€èµ·ï¼Œçœ‹https://www.biostars.org/p/332836/</h4>

<h3 id="ç”¨raw-countä½œpca">ç”¨raw-countä½œPCA</h3>

<p>å½’ä¸€åŒ–å‚è€ƒï¼šhttps://cloud.tencent.com/developer/article/1486102</p>

<p>æœ‰æ—¶å½“è¡¨è¾¾é‡ä¸º0æ—¶ï¼Œå–logä¼šå‡ºç°é”™è¯¯ï¼Œå¯ä»¥log(counts+1)æ¥å–logå€¼ã€‚å½“x=1æ—¶ï¼Œæ‰€æœ‰çš„logç³»åˆ—å‡½æ•°å€¼éƒ½ä¸º0ã€‚è¿™æ ·åŸæœ¬è¡¨è¾¾é‡ä¸º0çš„å€¼ï¼Œå–logåä»ä¸º0ã€‚ è¿™ä¹Ÿå°±æ˜¯UCSCçš„XENAä¸‹è½½åˆ°çš„è¡¨è¾¾çŸ©é˜µçš„å½¢å¼ã€‚</p>

<p>è¯»å–featureCountç»“æœæ–‡ä»¶ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>read.table("all_feature.txt",header=T,skip=1,sep="\t",row.names = 1)-&gt;raw_count
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å–6ï½11åˆ—</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>raw_count[,6:11]-&gt;Ci_RawCount
</pre></td></tr></tbody></table></code></pre></div></div>

<p>åŒ–ä¸ºçŸ©é˜µ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>as.matrix(Ci_RawCount)-&gt;Ci_RawCount
##æ”¹åå­—
colnames(Ci_RawCount)&lt;-c("X0_2","X0_7","X0_6","A6_1","A6_2","A6_4")
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å½’ä¸€åŒ–ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>log2(Ci_RawCount+1)-&gt;Ci_logCount
##è½¬ç½®
t(Ci_logCount)-&gt;Ci_logCount
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ç¬¬ä¸€ç§æ–¹æ³•ç”»å›¾:</p>

<p>ç”¨ggfortifyåŒ…ç”»å›¾ï¼Œé‡åˆ°â€œError: Objects of type prcomp not supported by autoplot.â€ï¼Œé‡æ–°åŠ è½½è¿™ä¸ªåŒ…å°±å¥½äº†ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>library(ggfortify)
label_raw&lt;-as.data.frame(Ci_logCount)
label_raw$group&lt;-group
autoplot(prcomp(Ci_logCount),data=label_raw,colour='group',shape=FALSE,label.size=3)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/Users/cooper/Desktop/%E6%96%87%E7%8C%AE/typora/science/image-20200407043606492.png" alt="image-20200407043606492" /></p>

<p>ç¬¬äºŒç§æ–¹æ³•ç”»å›¾ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>project.pca &lt;- prcomp(Ci_logCount)
summary(project.pca)
#Determine the proportion of variance of each component
#Proportion of variance equals (PC stdev^2) / (sum all PCs stdev^2)
project.pca.proportionvariances &lt;- ((project.pca$sdev^2) / (sum(project.pca$sdev^2)))*100
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Scree plot</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>barplot(project.pca.proportionvariances, cex.names=1, xlab=paste("Principal component (PC), 1-", length(project.pca$sdev)), ylab="Proportion of variation (%)", main="Scree plot", ylim=c(0,100))
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/Users/cooper/Desktop/%E6%96%87%E7%8C%AE/typora/science/image-20200407040437164.png" alt="image-20200407040437164" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>par(cex=1.0, cex.axis=0.8, cex.main=0.8)
pairs(project.pca$x[,1:5], col="black", main="Principal components analysis bi-plot\nPCs 1-5", pch=16)
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/Users/cooper/Desktop/%E6%96%87%E7%8C%AE/typora/science/image-20200407040530899.png" alt="image-20200407040530899" /></p>
:ET