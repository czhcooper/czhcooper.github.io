I"ÿX<p>samæ–‡ä»¶ä»‹ç»ï¼šhttps://blog.csdn.net/genome_denovo/article/details/78712972</p>

<p>SAMï¼šThe Sequence Alignment / Map format</p>

<p>samæ–‡ä»¶ï¼šä¸¤éƒ¨åˆ†ï¼Œsam header å’Œalignment section</p>

<h3 id="some-concepts">Some concepts</h3>

<p>linear alignment</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>An alignment of a read to a single reference sequence that may include insertions,deletions, skips and clipping, but may not include direction changes (i.e., one portion of the alignment on forward strand and another portion of alignment on reverse strand). A linear alignment can be represented in a single SAM record.
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Chimeric alignment  (éçº¿æ€§æ¯”å¯¹ï¼‰</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>An alignment of a read that cannot be represented as a linear alignment. A chimeric alignment is represented as a set of linear alignments that do not have large overlaps. Typically, one of the linear alignments in a chimeric alignment is considered the â€œrepresentativeâ€ alignment, and the others are called â€œsupplementaryâ€ and are distinguished by the supplementary alignment flag. All the SAM records in a chimeric alignment have the same QNAME and the same values for 0x40 and 0x80 flags (see Section 1.4). The decision regarding which linear alignment is representative is arbitraryï¼ˆä»»æ„çš„ï¼‰.
</pre></td></tr></tbody></table></code></pre></div></div>

<p>read alignment</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>A linear alignment or a chimeric alignment that is the complete representation of the alignment of the read.
</pre></td></tr></tbody></table></code></pre></div></div>

<p>multiple mapping</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>The correct placement of a read may be ambiguous, e.g., due to repeats. In this case, there may be multiple read alignments for the same read. One of these alignments is considered primary. All the other alignments have the secondary alignment flag set in the SAM records that represent them. All the SAM records have the same QNAME and the same values for 0x40 and 0x80 flags. Typically the alignment designated primary is the best alignment, but the decision may be arbitrary.
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="the-sam-header">The SAM Header</h3>

<p><strong>samtools <code class="language-plaintext highlighter-rouge">æŸ¥çœ‹å¤´éƒ¨ä¿¡æ¯</code></strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>samtools view -H mapped.sam 
#bamæ–‡ä»¶ä¹Ÿå¯ä»¥
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="hd">@HD</h4>

<p>@HD     VN:1.0  SO:unsorted</p>

<blockquote>
  <p>â€”â€”VNï¼šæ ¼å¼ç‰ˆæœ¬ï¼›
		â€”â€”SOï¼šæ¯”å¯¹æ’åºç±»å‹(Sorting order of alignments)ï¼šunknownï¼ˆdefaultï¼‰ï¼›unsorted;queryname;coordinate
		â€”â€”æ›´å¤šç±»å‹çœ‹åŸæ–‡ä»¶</p>
</blockquote>

<p>samtools æŸ¥çœ‹SQ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>samtools view -H mapped.sam |grep "^@SQ"
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="sq">@SQ</h4>

<p>@SQ     SN:reftig_1     LN:6668731
		@SQ     SN:reftig_16    LN:5336258
		@SQ     SN:reftig_19    LN:5151911
			â€¦â€¦.</p>

<blockquote>
  <p>â€”â€”@SQï¼šReference sequence dictionary. The order of @SQ lines defines the alignment sorting order.</p>

  <p>â€”â€”SNï¼šå‚è€ƒåºåˆ—åï¼Œ</p>

  <p>â€”â€”LNï¼šå‚è€ƒåºåˆ—é•¿åº¦</p>

  <p>â€”â€”æ›´å¤šçœ‹åŸæ–‡ä»¶</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>samtools view -H mapped.sam |grep "^@PG"
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="pg">@PG</h4>

<p>@PG     ID:hisat2       PN:hisat2       VN:2.1.0 CL:â€/Users/cooper/miniconda3/envs/python3.5/bin/hisat2-align-s â€“wrapper basic-0 -p 4 â€“no-softclip â€“no-discordant â€“min-intronlen 20 â€“max-intronlen 5000 â€“rna-strandness FR -x hisat2_index/cs -S hisat2_results/mapped.sam -1 /tmp/4319.inpipe1 -2 /tmp/4319.inpipe2â€</p>

<blockquote>
  <p>â€”â€”@PGï¼šprogram</p>

  <p>â€”â€”IDï¼šprogram record identifier</p>

  <p>â€”â€”PNï¼šprogram name</p>

  <p>â€”â€”VNï¼šprogram version</p>

  <p>â€”â€”CLï¼šcommand line</p>
</blockquote>

<h3 id="the-sam-alignment-section">The SAM Alignment Section</h3>

<p>é€šå¸¸åŒ…å«11åˆ—+1ä¸ªå¯é€‰åˆ—</p>

<p>samtools æŸ¥çœ‹ä¸»ä½“éƒ¨åˆ†,+çœ‹ç¬¬ä¸€è¡Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Samtools view mapped.sam |head -n 1
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>samtools view mapped.sam |tr '\t' '\n'|head -n 11
#tr '\t' '\n'ï¼šå°†\tâ€”â€”tabæ¢æˆ\nå›è½¦ç¬¦ï¼Œå³æ¢è¡Œ
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>ST-E00299:129:HMTFKCCXX:2:1101:5994:2346</p>

  <p>73</p>

  <p>reftig_23</p>

  <p>715574</p>

  <p>60</p>

  <p>150M</p>

  <p>=</p>

  <p>715574</p>

  <p>0</p>

  <p>CGCCATCACCGGCGGTTGGTAGCCGTTAGGCGTCGCGAAAGAGTCGTCCCTCGGCTCGTACTCGGGCA</p>

  <p>CGGACGAATAGTAGGCGTTGGCGGGATTGTGACGTGCCGATGACGTAGAATCGAAGTGAGAGTGGGAGG</p>

  <p>AGGAGCCGGTGGA</p>

  <p>AAFFFKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKKAKKKKKKKKFKKKKKKKKFFKKKKKK</p>

  <p>KKKKKKKKKKKKKKKKKKKKFKFKKKKKKKKKKKFK7FFKKKFFFKFFKKKKFKKKKK,FKKAFFKKKKK,AFF(</p>

  <p>AAK</p>

</blockquote>

<p>â€”â€”QNAMEï¼šï¼ˆquery nameï¼‰æ¯”å¯¹çš„readsåç§°</p>

<p>â€”â€”FLAGï¼šï¼ˆbitwise flagï¼‰æ¯”å¯¹ç±»å‹ï¼› æ¢æˆäºŒè¿›åˆ¶æ ¼å¼</p>

<p>å¯ç”¨samtools flags æŸ¥çœ‹å¹¶äº’æ¢è§£é‡Šï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>samtools flags
##
Flags:
	0x1	PAIRED        .. paired-end (or multiple-segment) sequencing technology
	0x2	PROPER_PAIR   .. each segment properly aligned according to the aligner
	0x4	UNMAP         .. segment unmapped
	0x8	MUNMAP        .. next segment in the template unmapped
	0x10	REVERSE       .. SEQ is reverse complemented
	0x20	MREVERSE      .. SEQ of the next segment in the template is reversed
	0x40	READ1         .. the first segment in the template
	0x80	READ2         .. the last segment in the template
	0x100	SECONDARY     .. secondary alignment
	0x200	QCFAIL        .. not passing quality controls
	0x400	DUP           .. PCR or optical duplicate
	0x800	SUPPLEMENTARY .. supplementary alignment
	##
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>samtools flags 147
##
0x93	147	PAIRED,PROPER_PAIR,REVERSE,READ2
##
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>samtools flags Pairedï¼Œread2
##
0x41	65	PAIRED,READ1
##
</pre></td></tr></tbody></table></code></pre></div></div>

<p>â€”â€”RNAMEï¼šthe reference nameã€‚æœªæ¯”å¯¹ä¸ºï¼š*</p>

<p>â€”â€”POSï¼šï¼ˆthe position on the reference sequenceï¼‰æ¯”å¯¹çš„ä½ç½®ä¿¡æ¯ã€‚ï¼ˆusing 1-based</p>

<p>indexingï¼‰æˆ‘çš„ç†è§£ï¼šå‡è®¾æœ€å·¦ç«¯æ¯”å¯¹ä¸Šçš„åºåˆ—ä½ç½®æ˜¯5ï¼Œåˆ™è¾“å‡ºä¸º5.æœªæ¯”å¯¹ä¸Šä¸º0.</p>

<p>â€”â€”MAPQï¼šï¼ˆthe mapping qualityï¼‰æ¯”å¯¹è´¨é‡ï¼Œæè¿°æ¯”å¯¹é”™è¯¯ç‡ï¼Œè·Ÿç¢±åŸºè´¨é‡å·®ä¸å¤šï¼Œå¦‚é”™è¯¯ç‡ç™¾åˆ†ç™¾æ—¶ï¼Œ</p>

<p>Q=-10log~10~P, P=1, æ­¤æ—¶Q=0.</p>

<p>â€”â€”CIGAR:(the CIGAR string)æè¿°æ¯”å¯¹æƒ…å†µï¼Œå¦‚matching basesï¼›insertion/deletionï¼Œclippingç­‰ã€‚</p>

<h3 id="samtools-commandline">Samtools commandâ€”Line</h3>

<p>å‚è€ƒã€ŠBioinformatics Data Skillsã€‹</p>

<p>çŸ¥ä¹samæ–‡ä»¶ä½¿ç”¨ï¼šhttps://zhuanlan.zhihu.com/p/49760719</p>

<h3 id="1view">1.view</h3>

<h5 id="usage">Usage</h5>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre>Usage: samtools view [options] &lt;in.bam&gt;|&lt;in.sam&gt; [region1 [...]]
é»˜è®¤æƒ…å†µä¸‹ä¸åŠ  regionï¼Œåˆ™æ˜¯è¾“å‡ºæ‰€æœ‰çš„ region.

Options: -b       output BAM
                  é»˜è®¤ä¸‹è¾“å‡ºæ˜¯ SAM æ ¼å¼æ–‡ä»¶ï¼Œè¯¥å‚æ•°è®¾ç½®è¾“å‡º BAM æ ¼å¼
         -h       print header for the SAM output
                  é»˜è®¤ä¸‹è¾“å‡ºçš„ sam æ ¼å¼æ–‡ä»¶ä¸å¸¦ headerï¼Œè¯¥å‚æ•°è®¾å®šè¾“å‡ºsamæ–‡ä»¶æ—¶å¸¦ header ä¿¡æ¯
         -H       print header only (no alignments)
         -S       input is SAM
                  é»˜è®¤ä¸‹è¾“å…¥æ˜¯ BAM æ–‡ä»¶ï¼Œè‹¥æ˜¯è¾“å…¥æ˜¯ SAM æ–‡ä»¶ï¼Œåˆ™æœ€å¥½åŠ è¯¥å‚æ•°ï¼Œå¦åˆ™æœ‰æ—¶å€™ä¼šæŠ¥é”™ã€‚
         -u       uncompressed BAM output (force -b)
                  è¯¥å‚æ•°çš„ä½¿ç”¨éœ€è¦æœ‰-bå‚æ•°ï¼Œèƒ½èŠ‚çº¦æ—¶é—´ï¼Œä½†æ˜¯éœ€è¦æ›´å¤šç£ç›˜ç©ºé—´ã€‚
         -c       Instead of printing the alignments, only count them and print the 
                  total number. All filter options, such as â€˜-fâ€™, â€˜-Fâ€™ and â€˜-qâ€™ , 
                  are taken into account.
         -1       fast compression (force -b)
         -x       output FLAG in HEX (samtools-C specific)
         -X       output FLAG in string (samtools-C specific)
         -c       print only the count of matching records
         -L FILE  output alignments overlapping the input BED FILE [null]
         -t FILE  list of reference names and lengths (force -S) [null]
                  ä½¿ç”¨ä¸€ä¸ªlistæ–‡ä»¶æ¥ä½œä¸ºheaderçš„è¾“å…¥
         -T FILE  reference sequence file (force -S) [null]
                  ä½¿ç”¨åºåˆ—fastaæ–‡ä»¶ä½œä¸ºheaderçš„è¾“å…¥
         -o FILE  output file name [stdout]
         -R FILE  list of read groups to be outputted [null]
         -f INT   required flag, 0 for unset [0]
         -F INT   filtering flag, 0 for unset [0] 
                  Skip alignments with bits present in INT [0]
                  æ•°å­—4ä»£è¡¨è¯¥åºåˆ—æ²¡æœ‰æ¯”å¯¹åˆ°å‚è€ƒåºåˆ—ä¸Š
                  æ•°å­—8ä»£è¡¨è¯¥åºåˆ—çš„mateåºåˆ—æ²¡æœ‰æ¯”å¯¹åˆ°å‚è€ƒåºåˆ—ä¸Š
         -q INT   minimum mapping quality [0]
         -l STR   only output reads in library STR [null]
         -r STR   only output reads in read group STR [null]
         -s FLOAT fraction of templates to subsample; integer part as seed [-1]
         -?       longer help
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="example">exampleï¼š</h5>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>å°†samæ–‡ä»¶è½¬æ¢æˆbamæ–‡ä»¶
$ samtools view -bS abc.sam &gt; abc.bam
$ samtools view -b -S abc.sam -o abc.bam

æå–æ¯”å¯¹åˆ°å‚è€ƒåºåˆ—ä¸Šçš„æ¯”å¯¹ç»“æœ
$ samtools view -bF 4 abc.bam &gt; abc.F.bam

æå–paired readsä¸­ä¸¤æ¡readséƒ½æ¯”å¯¹åˆ°å‚è€ƒåºåˆ—ä¸Šçš„æ¯”å¯¹ç»“æœï¼Œåªéœ€è¦æŠŠä¸¤ä¸ª4+8çš„å€¼12ä½œä¸ºè¿‡æ»¤å‚æ•°å³å¯
$ samtools view -bF 12 abc.bam &gt; abc.F12.bam

æå–æ²¡æœ‰æ¯”å¯¹åˆ°å‚è€ƒåºåˆ—ä¸Šçš„æ¯”å¯¹ç»“æœ
$ samtools view -bf 4 abc.bam &gt; abc.f.bam

æå–bamæ–‡ä»¶ä¸­æ¯”å¯¹åˆ°caffold1ä¸Šçš„æ¯”å¯¹ç»“æœï¼Œå¹¶ä¿å­˜åˆ°samæ–‡ä»¶æ ¼å¼
$ samtools view abc.bam scaffold1 &gt; scaffold1.sam

æå–scaffold1ä¸Šèƒ½æ¯”å¯¹åˆ°30kåˆ°100kåŒºåŸŸçš„æ¯”å¯¹ç»“æœ
$ samtools view abc.bam scaffold1:30000-100000 $gt; scaffold1_30k-100k.sam

æ ¹æ®fastaæ–‡ä»¶ï¼Œå°† header åŠ å…¥åˆ° sam æˆ– bam æ–‡ä»¶ä¸­
$ samtools view -T genome.fasta -h scaffold1.sam &gt; scaffold1.h.sam
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="sam-to-bam">sam to bamï¼š</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>samtools view -b mapped.sam &gt; mapped.bam
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="bam-to-sam">Bam to sam:</h5>

<p>no headerï¼ˆdefaultï¼‰</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>samtools view mapped.bam &gt; mapped.sam
#æ²¡æœ‰headerçš„samæ–‡ä»¶ä¸èƒ½è½¬bamæ–‡ä»¶ï¼Œru
Samtools view -b mapped.sam &gt; mapped.bam
#æŠ¥é”™ï¼š
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å¦‚æœæƒ³è¦headerï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>samtools view -h mapped.bam &gt; mapped.sam
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2sort">2.sort</h3>

<p>æ ¹æ®æ¯”å¯¹ä½ç½®æ’åºï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>samtools sort mapped.bam &gt; mapped.sorted.bam
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å¯ä»¥é€‰æ‹©coreå’Œmemory</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>samtools sort -@ 4 -m 8G mapped.bam &gt; mapped.sorted.bam
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3index">3.index</h3>

<p>ä¸ºäº†è®©è®¡ç®—æœºæ›´å¥½çš„æŸ¥æ‰¾ï½æˆ‘çš„ç†è§£</p>

<p>å»ºç«‹ç´¢å¼•åå°†äº§ç”Ÿåç¼€ä¸º.baiçš„æ–‡ä»¶ï¼Œç”¨äºå¿«é€Ÿçš„éšæœºå¤„ç†ã€‚å¾ˆå¤šæƒ…å†µä¸‹éœ€è¦æœ‰baiæ–‡ä»¶çš„å­˜åœ¨ï¼Œç‰¹åˆ«æ˜¯æ˜¾ç¤ºåºåˆ—æ¯”å¯¹æƒ…å†µä¸‹ã€‚æ¯”å¦‚samtoolçš„tviewå‘½ä»¤å°±éœ€è¦ï¼›gbrowse2æ˜¾ç¤ºreadsçš„æ¯”å¯¹å›¾å½¢çš„æ—¶å€™ä¹Ÿéœ€è¦ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>samtools index mapped.sorted.bam
#ç”Ÿæˆmapped.sorted.bam.bai
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="æ ¹æ®ä½ç½®æå–æƒ³è¦çš„ä¿¡æ¯">æ ¹æ®ä½ç½®æå–æƒ³è¦çš„ä¿¡æ¯</h5>

<p>å¦‚æƒ³æå–reftig_23çš„æŸä½ç½®çš„æ¯”å¯¹æƒ…å†µï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>samtools view mapped.sorted.bam reftig_23:715574-715600 |head -n 3
##
...
ST-E00299:129:HMTFKCCXX:2:1113:28777:2856	147	reftig_23	715428	60 [...]
...
##
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æŠŠä¸Šé¢æå–çš„ä¿¡æ¯å†™å…¥æ–°çš„bamæ–‡ä»¶</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>samtools view mapped.sorted.bam reftig_23:715574-715600 &gt; new.sorted.bam
</pre></td></tr></tbody></table></code></pre></div></div>

<h5 id="filtering-alignment-with-samtools-view">Filtering alignment with samtools view</h5>

<p>æå–unmappedçš„readsï¼š</p>

<p>é¦–å…ˆçœ‹ummappedå¯¹åº”çš„bitwise flagsï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>samtools flags unmap
0x4	4	UNMAP
</pre></td></tr></tbody></table></code></pre></div></div>

<p>-f â€”â€”ä¿ç•™ç‰¹å®šflagsçš„ä¿¡æ¯</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>samtools view -f 4 mapped.bam 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>çœ‹å‰ä¸‰è¡Œï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>samtools view -f 4 mapped.bam ï½œhead -n 3
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>ST-E00299:129:HMTFKCCXX:2:1101:5994:2346	133	reftig_23	715574	0	*	=	715574	0	[â€¦]</p>

  <p>ST-E00299:129:HMTFKCCXX:2:1101:6177:2346	133	reftig_14	945545	0	*	=	945545	0	[â€¦]</p>

  <p>ST-E00299:129:HMTFKCCXX:2:1101:3579:2346	77	*	0	0	*	*	0	0	[â€¦]</p>
</blockquote>

<p>æŸ¥çœ‹113ï¼Œ77å¯¹åº”çš„æ¯”å¯¹æƒ…å†µï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>samtools flags 113
0x85	133	PAIRED,UNMAP,READ2
samtools flags 77
0x4d	77	PAIRED,UNMAP,MUNMAP,READ1
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å¦‚æœæƒ³æå–READ1ï¼Œproper_pair:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>samtools flags read1ï¼Œproper_pair
0x42	66	PROPER_PAIR,READ1
samtools view -f 66 mapped.sam &gt; mapped.youwant.bam
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å¦‚æœæƒ³æå–mappedçš„readsï¼Œç”¨-Få‚æ•°ï¼Œ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>samtools view -F 4 mapped.bam &gt; mapped.hits.bam
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="4faidx">4.faidx</h3>

<p>å¯¹fastaæ–‡ä»¶å»ºç«‹ç´¢å¼•,ç”Ÿæˆçš„ç´¢å¼•æ–‡ä»¶ä»¥.faiåç¼€ç»“å°¾ã€‚è¯¥å‘½ä»¤ä¹Ÿèƒ½ä¾æ®ç´¢å¼•æ–‡ä»¶å¿«é€Ÿæå–fastaæ–‡ä»¶ä¸­çš„æŸä¸€æ¡ï¼ˆå­ï¼‰åºåˆ—</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>Usage: samtools faidx &lt;in.bam&gt; [ [...]]

å¯¹åŸºå› ç»„æ–‡ä»¶å»ºç«‹ç´¢å¼•
$ samtools faidx genome.fasta
ç”Ÿæˆäº†ç´¢å¼•æ–‡ä»¶genome.fasta.fai,æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œåˆ†æˆäº†5åˆ—ã€‚ç¬¬ä¸€åˆ—æ˜¯å­åºåˆ—çš„åç§°ï¼›
ç¬¬äºŒåˆ—æ˜¯å­åºåˆ—çš„é•¿åº¦ï¼›ä¸ªäººè®¤ä¸ºâ€œç¬¬ä¸‰åˆ—æ˜¯åºåˆ—æ‰€åœ¨çš„ä½ç½®â€ï¼Œå› ä¸ºè¯¥æ•°å­—ä»ä¸Šå¾€ä¸‹é€æ¸å˜å¤§ï¼Œ
æœ€åçš„æ•°å­—æ˜¯genome.fastaæ–‡ä»¶çš„å¤§å°ï¼›ç¬¬4å’Œ5åˆ—ä¸çŸ¥æ˜¯å•¥æ„æ€ã€‚äºæ˜¯é€šè¿‡æ­¤æ–‡ä»¶ï¼Œå¯ä»¥å®š
ä½å­åºåˆ—åœ¨fastaæ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„å­˜æ”¾ä½ç½®ï¼Œç›´æ¥å¿«é€Ÿè°ƒå‡ºå­åºåˆ—ã€‚

ç”±äºæœ‰ç´¢å¼•æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¾ˆå¿«ä»åŸºå› ç»„ä¸­æå–åˆ°fastaæ ¼å¼çš„å­åºåˆ—
$ samtools faidx genome.fasta scffold_10 &gt; scaffold_10.fasta
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="5tview">5.tview</h3>

<p>tviewèƒ½ç›´è§‚çš„æ˜¾ç¤ºå‡ºreadsæ¯”å¯¹åŸºå› ç»„çš„æƒ…å†µï¼Œå’ŒåŸºå› ç»„æµè§ˆå™¨æœ‰ç‚¹ç±»ä¼¼ã€‚</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>Usage: samtools tview &lt;aln.bam&gt; [ref.fasta]

å½“ç»™å‡ºå‚è€ƒåŸºå› ç»„çš„æ—¶å€™ï¼Œä¼šåœ¨ç¬¬ä¸€æ’æ˜¾ç¤ºå‚è€ƒåŸºå› ç»„çš„åºåˆ—ï¼Œå¦åˆ™ï¼Œç¬¬ä¸€æ’å…¨ç”¨Nè¡¨ç¤ºã€‚
æŒ‰ä¸‹ g ï¼Œåˆ™æç¤ºè¾“å…¥è¦åˆ°è¾¾åŸºå› ç»„çš„æŸä¸€ä¸ªä½ç‚¹ã€‚ä¾‹å­â€œscaffold_10:1000"è¡¨ç¤ºåˆ°è¾¾ç¬¬
10å·scaffoldçš„ç¬¬1000ä¸ªç¢±åŸºä½ç‚¹å¤„ã€‚
ä½¿ç”¨H(å·¦ï¼‰Jï¼ˆä¸Šï¼‰Kï¼ˆä¸‹ï¼‰Lï¼ˆå³ï¼‰ç§»åŠ¨æ˜¾ç¤ºç•Œé¢ã€‚å¤§å†™å­—æ¯ç§»åŠ¨å¿«ï¼Œå°å†™å­—æ¯ç§»åŠ¨æ…¢ã€‚
ä½¿ç”¨ç©ºæ ¼å»ºå‘å·¦å¿«é€Ÿç§»åŠ¨ï¼ˆå’Œ L ç±»ä¼¼ï¼‰ï¼Œä½¿ç”¨Backspaceé”®å‘å·¦å¿«é€Ÿç§»åŠ¨ï¼ˆå’Œ H ç±»ä¼¼ï¼‰ã€‚
Ctrl+H å‘å·¦ç§»åŠ¨1kbç¢±åŸºè·ç¦»ï¼› Ctrl+L å‘å³ç§»åŠ¨1kbç¢±åŸºè·ç¦»
å¯ä»¥ç”¨é¢œè‰²æ ‡æ³¨æ¯”å¯¹è´¨é‡ï¼Œç¢±åŸºè´¨é‡ï¼Œæ ¸è‹·é…¸ç­‰ã€‚30ï½40çš„ç¢±åŸºè´¨é‡æˆ–æ¯”å¯¹è´¨é‡ä½¿ç”¨ç™½è‰²è¡¨ç¤ºï¼›
20ï½30é»„è‰²ï¼›10ï½20ç»¿è‰²ï¼›0ï½10è“è‰²ã€‚
ä½¿ç”¨ç‚¹å·'.'åˆ‡æ¢æ˜¾ç¤ºç¢±åŸºå’Œç‚¹å·ï¼›ä½¿ç”¨råˆ‡æ¢æ˜¾ç¤ºread nameç­‰
è¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„ä½¿ç”¨è¯´æ˜ï¼Œå…·ä½“æŒ‰ ï¼Ÿ é”®æ¥æŸ¥çœ‹ã€‚
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="6flagstat">6.flagstat</h3>

<h3 id="7samtools-fastq">7.samtools fastq</h3>

:ET